# AI Document Review 部署指南

## 项目简介

这是一个基于 **FastAPI + React + PromptFlow** 的 AI 文档审查系统，使用 DeepSeek AI 模型对 PDF 文档进行智能审查。

**主要技术栈：**
- 后端：FastAPI + Python 3.x
- 前端：React + Vite
- AI 模型：DeepSeek AI
- 文档处理：MinerU
- 数据库：SQLite（本地）

---

## 📋 前置要求

在开始部署前，请确保已安装以下软件：

| 软件 | 版本要求 | 下载地址 | 检查命令 |
|------|---------|---------|---------|
| Python | 3.8+ | https://www.python.org/ | `python --version` |
| Node.js | 16+ | https://nodejs.org/ | `node --version` |
| npm | 随 Node.js | - | `npm --version` |

> **注意**：安装 Python 时请务必勾选 **"Add Python to PATH"**

---

## 🚀 快速开始（三步启动）

### 第一步：配置环境变量

#### 1. 创建配置文件

打开命令行，进入项目根目录，执行：

```bash
copy app\api\.env.tpl app\api\.env
```

#### 2. 编辑配置文件

使用记事本或代码编辑器打开 `app\api\.env` 文件。

#### 3. 填写必需的 API Key

找到以下配置项并填写：

```env
# DeepSeek API（必需 - 必须配置）
DEEPSEEK_API_KEY=你的DeepSeek密钥

# MinerU API（可选 - 推荐配置以获得最佳体验）
MINERU_API_KEY=你的MinerU密钥
```

**如何获取 API Key：**

- **DeepSeek**：访问 https://platform.deepseek.com/ 注册并获取 API Key
- **MinerU**：访问 https://mineru.net/ 注册并获取 API Key（可选）

其他配置项保持默认即可。

---

### 第二步：安装依赖

项目提供了自动化安装脚本，双击运行或在命令行执行：

```bash
install.bat
```

该脚本会自动完成：
- ✅ 检查 Python、Node.js、npm 环境
- ✅ 创建 Python 虚拟环境
- ✅ 安装后端 Python 依赖
- ✅ 安装前端 npm 依赖

预计时间：2-5 分钟（取决于网络速度）

---

### 第三步：启动项目

双击运行或在命令行执行：

```bash
start.bat
```

启动后：
- 会在新窗口打开后端服务（FastAPI）
- 会在新窗口打开前端服务（Vite）
- 浏览器会自动打开前端界面

**服务地址：**
- 🎨 前端 UI：http://localhost:5173
- 🔧 后端 API：http://localhost:8000
- 📖 API 文档：http://localhost:8000/docs

---

## 🛑 停止服务

### 方法一：使用停止脚本
```bash
stop.bat
```

### 方法二：手动停止
直接关闭启动时打开的两个命令行窗口即可

---

## 📂 项目目录结构

```
ai-document-review/
├── app/
│   ├── api/              # 后端 FastAPI 服务
│   │   ├── main.py       # API 入口文件
│   │   ├── .env          # 环境配置 ⚠️ 需要配置
│   │   ├── .env.tpl      # 配置模板
│   │   ├── venv/         # Python 虚拟环境（自动创建）
│   │   └── requirements.txt
│   └── ui/               # 前端 React 应用
│       └── .env.tpl      # 前端环境变量模板
├── docs/                 # 项目文档
├── install.bat           # 安装脚本 🚀
├── start.bat             # 启动脚本 🚀
└── stop.bat              # 停止脚本
```

---

## ⚙️ 配置文件详细说明

### app\api\.env 配置项

| 配置项 | 说明 | 必需 | 默认值 |
|--------|------|------|--------|
| `DEEPSEEK_API_KEY` | DeepSeek API 密钥 | ✅ **必需** | - |
| `DEEPSEEK_BASE_URL` | API 地址 | - | https://api.deepseek.com/v1 |
| `DEEPSEEK_MODEL` | 模型名称 | - | deepseek-chat |
| `MINERU_API_KEY` | MinerU 密钥 | ⚠️ 推荐 | - |
| `MINERU_BASE_URL` | MinerU 地址 | - | https://mineru.net |
| `SQLITE_PATH` | 数据库路径 | - | ./app/data/app.db |
| `PAGINATION` | 文档分段大小 | - | 32 |
| `DEBUG` | 调试模式 | - | True |

---

## ❓ 常见问题排查

### 问题 1：启动失败 - "Python 未安装"

**原因**：系统未安装 Python 或未添加到 PATH

**解决方案**：
1. 访问 https://www.python.org/
2. 下载并安装 Python 3.8 或更高版本
3. ⚠️ 安装时务必勾选 **"Add Python to PATH"**
4. 重启命令行窗口

---

### 问题 2：启动失败 - "Node.js 未安装"

**原因**：系统未安装 Node.js

**解决方案**：
1. 访问 https://nodejs.org/
2. 下载并安装 LTS 版本
3. 重启命令行窗口

---

### 问题 3：后端报错 - "API Key 未配置"

**原因**：`.env` 文件中的 `DEEPSEEK_API_KEY` 未填写

**解决方案**：
1. 打开 `app\api\.env` 文件
2. 填写你的 DeepSeek API Key
3. 保存文件并重新启动

---

### 问题 4：pip 安装依赖失败

**原因**：网络问题或 pip 源访问慢

**解决方案**：使用国内镜像源

```bash
cd app\api
venv\Scripts\activate
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

---

### 问题 5：npm 安装依赖失败

**原因**：网络问题或 npm 源访问慢

**解决方案**：使用国内镜像源

```bash
npm config set registry https://registry.npmmirror.com
cd app\ui
npm install
```

---

### 问题 6：前端无法连接后端

**原因**：后端服务未正常启动

**解决方案**：
1. 检查后端命令行窗口是否有错误
2. 访问 http://localhost:8000/docs 确认后端运行
3. 确保防火墙未阻止 8000 端口

---

### 问题 7：端口已被占用

**原因**：8000 或 5173 端口已被其他程序使用

**解决方案**：

**方法一：关闭占用端口的程序**
```bash
# 查看端口占用
netstat -ano | findstr :8000
netstat -ano | findstr :5173

# 结束进程（PID 为上面查到的进程 ID）
taskkill /PID 进程ID /F
```

**方法二：修改端口**
- 后端：编辑 `start.bat`，修改 `--port 8000` 为其他端口
- 前端：编辑 `app\ui\vite.config.ts`，修改 server port

---

## 🔧 高级选项

### 仅启动后端服务

```bash
cd app\api
venv\Scripts\activate
python -m uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

### 仅启动前端服务

```bash
cd app\ui
npm run dev
```

### 重置虚拟环境

如果遇到依赖问题，可以重新创建虚拟环境：

```bash
cd app\api
rmdir /s /q venv
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt
```

### 清理数据库

```bash
del app\data\app.db
```

---

## 📝 使用说明

### 第一次使用

1. 访问 http://localhost:5173
2. 点击上传按钮，选择一个 PDF 文件
3. 系统会自动进行 AI 审查
4. 查看审查结果和问题列表

### 查看 API 文档

访问 http://localhost:8000/docs 查看：
- 所有可用的 API 接口
- 在线调试工具
- 请求/响应格式

---

## 🔐 安全提示

- ⚠️ **不要将 `.env` 文件提交到 Git 仓库**
- ⚠️ **妥善保管你的 API Key**
- ⚠️ 生产环境请修改 `DEBUG=False`

---

## 📚 更多资源

- **项目文档**：`docs/Getting_Started.md`
- **API 文档**：http://localhost:8000/docs
- **DeepSeek 平台**：https://platform.deepseek.com/
- **MinerU 平台**：https://mineru.net/

---

## 🎯 总结

**快速启动三步曲：**

1. **配置**：编辑 `app\api\.env`，填写 `DEEPSEEK_API_KEY`
2. **安装**：运行 `install.bat`
3. **启动**：运行 `start.bat`

**关键文件：**
- 安装脚本：`install.bat`
- 启动脚本：`start.bat`
- 停止脚本：`stop.bat`
- 后端配置：`app\api\.env` ⚠️ **必须配置**

**服务地址：**
- 前端 UI：http://localhost:5173
- 后端 API：http://localhost:8000
- API 文档：http://localhost:8000/docs

---

祝你部署顺利！如有问题，请参考上面的"常见问题排查"部分。
